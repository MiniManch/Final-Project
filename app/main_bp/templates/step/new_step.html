{% extends 'partials/main/base.html' %}

{% block content %}
{% include "partials/main/navbar.html" %}

<main  class="col-md-8 shadow bg-white rounded">
      <img id='prev-btn' class='disabled' src="https://img.icons8.com/glyph-neue/64/back.png" alt="back"/>
      <img id='next-btn' src="https://img.icons8.com/glyph-neue/64/forward--v1.png" alt="back"/>
    <form id="regForm" class='form' method="POST" action="#" enctype="multipart/form-data">
    {{ form.hidden_tag()}}
      <div id="form-container">
          <div id="progress-bar"></div>

          <h1 class="title">{{title}}</h1>


          {{form.subject(class="form-control active",id='subject')}}
          {{form.content(class="form-control disabled",id='content',placeholder='This is the content of this step!')}}

          <div id="tools" class='disabled'>
              <!-- Tools Search Bar-->
              <div class="row mb-5">
                <div class="col-lg-8 mx-auto ">
                    <div class="bg-white p-1 rounded shadow">
                    <!-- Custom rounded search bars with input group -->
                        <form class='form' method="POST"  onsubmit="event.preventDefault();" action="#" >
                        {{ search.hidden_tag()}}
                                <div class="p-1 bg-light rounded rounded-pill shadow-sm mb-4">
                                    <div class="input-group">
                                    {{search.text(class="form-control border-0 bg-light",id='search' ,**{'placeholder':"What're you searching for?", 'aria-describedby':"button-addon1"})}}
                                    <div class="input-group-append">
                                    <div id="button-addon3"  class="btn btn-link text-success"><img src="https://img.icons8.com/fluency-systems-regular/48/null/search--v1.png"/></div>
                                    </div>
                                    <div  id='reset_button' class="btn btn-link text-success"><img src="https://img.icons8.com/ios/50/recurring-appointment.png"/></div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <!-- End of Search Bar -->

            <!--Tool Cards -->
              <div class="row all_tools">
                  {% for tool in tools %}
                <div class="col-md-4 tool-container">
                    <div class="blog-card blog-card-blog">
                      <div class="blog-card-image">
                          <img class="img" src="https://res.cloudinary.com/drzcke4vu/image/upload/v1683294873/{{tool.image}}">
                          <div class="ripple-cont"></div>
                      </div>
                      <div class="blog-table">
                          <h6 class="blog-category blog-text-success tool-name">{{tool.name}}</h6>
                          <h4 class="blog-card-caption ">
                              {{tool.usage}}
                          </h4>
                          <div  class="btn btn-link text-success add_button"><img src="https://img.icons8.com/ios/50/add--v1.png"/><span class="disabled tool_id">{{tool.id}}</span></div>
                          
                      </div>
                    </div>
                </div>
                  {% endfor %}
              </div>
          </div>
          {{form.tools(style='display:none;', id='tools_input')}}
          {{form.image(class="form-control disabled third",id='image')}}

          {{form.submit(class="btn btn-success disabled",id='submit')}}
      </div>
    </form>
</main>

<script src="{{url_for('main_bp.static',filename='main/scripts/new_newtool.js')}}"></script>
<script>
    // re enters image into image input if its edit

function loadURLToInputFiled(url){
  getImgURL(url, (imgBlob)=>{
    // Load img blob to input
    // WIP: UTF8 character error
    let fileName = 'Your  Picture.jpg'
    let file = new File([imgBlob], fileName,{type:"image/jpeg", lastModified:new Date().getTime()}, 'utf-8');
    let container = new DataTransfer();
    container.items.add(file);
    document.querySelector('#image').files = container.files;
  })
}

// xmlHTTP return blob respond
function getImgURL(url, callback){
  var xhr = new XMLHttpRequest();
  xhr.onload = function() {
      callback(xhr.response);
  };
  xhr.open('GET', url);
  xhr.responseType = 'blob';
  xhr.send();
}

if ('{{edit}}' !== ''){

    loadURLToInputFiled('{{edit}}');
}

</script>
{% endblock %}
